Приложение ищет игры в стиме, отсортирваынне по популярности, на которые сейчас есть скидки и показывает лучшую цену, сравнивая ещё с тремя другими магазиными.

# Запуск
Для запуска используется команда `docker compose up` или `./build.sh` в этой директории.
Зайти на сайт можно по адресу http://127.0.0.1:5001/, если контейнер запущен локально на том же компьютере или по адресу сервера, на котором запущен этот контейнер.
На странице сайта отображаются самые популярные игры из Стима со скидками. Для игр, найденных в одном из других трёх магазинов (Gabe Store, zaka-zaka, steampay) отобрается лучшая цена. Для игр только из Стима также отбражается примерная цена игры, если считать с комиссией сервисов пополнения кошелька.

Страница Стима подружается динамически на фронтенде, поэтому нужно время, чтобы база данных заполнилась. Когда парсер находит игры, которые уже до этого находил, он обновляет их цену.

# Устройство
Система состоит из трёх контейнеров: парсер, база данных и вебсайт. База данных хранится в папке `./db` относительно корня проекта. Докер композ создаёт эту папку для базы данных при первом запуске.

## Парсер
Для парсинга Стима используется библиотека Selenium, так как Стим подгружает контент динамически (код в parser/scrapers/steam_parser.py). Остальные три магазина парсятся одной функцией с аргументом, который определяет, какой из трёх магазинов будет парситься (функция find_game_price_and_link в parser/scrapers/other_shops_parser.py). Парсинг трёх сайтов удалось объеденить в одну функцию, так как было обнаружено, что они строят ссылки на страницы с играми по одинаковым правилам, разница только в названии класса элемента цены на странице. 

Парсер стима загружает страницу в браузере, нажимает кнопку «Show more» для того, чтобы найти больше игр на странице, а затем собирает все элементы игр на странице, откуда берёт название, информацию о цене и обложку. Парсер других магазинов составляет ссылку по шаблону, делает GET запрос и копирует информацию из элемента цены на странице.

Затем эта информация сохраняется в базе данных в соответсвующих таблицах.

Код для взаимодействия с базой данных в файле parser/db.py. В нём происходит подключение к базе данных, создание таблиц, если они ещё не существуют и отправка запросов. Всего есть четыре таблицы: game_prices, game_images, game_names и game_links. В game_prices цены в выбранных магазинах, в game_images ссылки на обложки игр из Стима для отображения на сайте, в game_names названия игр, как они указаны в Стиме, в game_links ссылки на покупку игр в остальных магазинах, кроме Стима.

## База данных
mysql, указана в Docker-compose.yaml. Используется volume для соединения папки с базой данных внутри контейнера и на компьютере, для того, чтобы данные сохранялись при пересборке контейнера.

## Сайт
В корне, по запросу по адресу `/`, Flask отдаёт главную страницу с заголовком и контейнером для карточек с играми. К странице прикреплён код на javscript, который делает запросы к серверу по адресу `/game-info/<game-id>`, чтобы получить объект игры, в котором прописаны цены и ссылки. Затем в зависимости от наличия игры в других магазинах, создаёт один из двух видов карточек и помещает на страницу.

По адресу `/<game-id>` отображается страница с игрой и таблицей сравнения цен. Эта страница также доступна по клику на карточки игр, которые продаются не только в Стиме.
Такой типа страницы также заполняется на фронтенде.


### Использование
При открытии сайта отображается траница со всеми найденными играми:
![image](https://github.com/user-attachments/assets/ce5ecc89-12c2-460b-9ffd-bb7a4ad4ecb9)

По клику на карточки с играми, найденными в других магазинах, открывается страницы игры с таблией цен в других магазинах:
![image](https://github.com/user-attachments/assets/05023f70-3340-4e04-a690-51f0eac8d586)

Названия магазинов — ссылки на страницу соответсвующей игры в данном магазине.

Клик на «Все игры» возвращае на начальную страницу со всеми играми.
